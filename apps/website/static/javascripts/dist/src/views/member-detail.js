define(["jquery","underscore","backbone"],function(e,s,t){var a=t.View.extend({el:".member-detail-container",messages:[],initialize:function(){console.log("MemberDetailView initialize")},events:{"click #send-mail":"handleSendAsync","click #send-info-request":"handleUpdateRequest","click #member-send-mail":"renderSendMailForm","click #member-request-info":"renderRequestInfoForm","click #member-delete":"handleDelete"},formIsValid:function(){return this.checkRequired()?(this.signalSuccess(),!0):(this.renderErrors(),!1)},checkRequired:function(){var t=this,a=!0;return s.forEach(e("input,textarea,select").filter("[required]:visible"),function(s){var s=e(s);""===s.val()&&(a=!1,t.signalRequiredError(s))}),a},signalRequiredError:function(e){this.messages.push(e.siblings("label").text()+" This field is required.")},signalError:function(e){this.messages.push(e)},signalSuccess:function(){e("#messages-container").html(""),window.scroll(0,0)},renderErrors:function(){var t=s.template(e("#errors-template").html(),{Errors:this.messages});e("#messages-container").html(t),this.messages=[],window.scroll(0,0)},renderSendMailForm:function(){var t=s.template(e("#send-mail-template").html());e("#send-mail-container").html(t)},renderRequestInfoForm:function(){var t=s.template(e("#send-info-request-template").html());e("#send-mail-container").html(t)},handleUpdateRequest:function(e){e.preventDefault(),this.messagesSent=0;var s=this;this.formIsValid()&&s.sendRequestToMember()},sendRequestToMember:function(){this.showLoading();var t=this,a={member_id:e("#member-id").val(),subject:e("#subject").val(),message:e("#message").val()};e.ajax({url:"/api/members/request-update/",type:"POST",data:a,success:function(){if(t.hideLoading(),t.messagesSent+=1,1===t.messagesSent)var a="1 request successfully sent.";else var a=t.messagesSent+" requests sent successfully.";var i=s.template(e("#messages-template").html(),{Messages:[a]});e("#messages-container").html(i)}})},handleSendAsync:function(e){e.preventDefault(),this.messagesSent=0;var s=this;this.formIsValid()&&s.sendMailToMember()},sendMailToMember:function(){this.showLoading();var t=this,a={member_id:e("#member-id").val(),message:e("#message").val(),subject:e("#subject").val()};e.ajax({url:"/api/members/send-mail/",type:"POST",data:a,success:function(){if(t.hideLoading(),t.messagesSent+=1,1===t.messagesSent)var a="1 email successfully sent.";else var a=t.messagesSent+" emails sent successfully.";var i=s.template(e("#messages-template").html(),{Messages:[a]});e("#messages-container").html(i)}})},handleDelete:function(s){s.preventDefault();var t=confirm("Are you sure you want to delete this Member?");if(1==t){this.showLoading();var a={member_id:e("#member-id").val()};e.ajax({url:"/api/members/delete/",type:"POST",data:a,success:function(e){e.redirect&&window.location.replace(e.redirect)}})}},showLoading:function(){var s='<div class="overlay"><img class="loading" src="/static/images/ajax-loader.gif"></div>';e(s).appendTo("body")},hideLoading:function(){e(".overlay").remove()}});return a});