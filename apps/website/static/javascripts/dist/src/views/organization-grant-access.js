define(["jquery","underscore","backbone"],function(e,s,r){var a=r.View.extend({messages:[],el:"#grant-access-container",initialize:function(){console.log("OrganizationGrantAccessView initialize")},events:{"click #btn-submit":"handleAccessGrant","click #btn-submit-ownership":"handleTransferOwnership"},formIsValid:function(){return this.checkRequired()?(this.signalSuccess(),!0):(this.renderErrors(),!1)},handleAccessGrant:function(r){r.preventDefault();var a=this;if(this.formIsValid()){this.showLoading();var i={organization_id:e("#organization-id").val(),username:e("#username").val()};e.ajax({url:"/api/organizations/grant-access/",type:"POST",data:i,success:function(r){if(a.hideLoading(),r.error){var i=s.template(e("#errors-template").html(),{Errors:[r.message]});e("#messages-container").html(i)}else{var i=s.template(e("#messages-template").html(),{Messages:[r.message]});e("#messages-container").html(i)}}})}},handleTransferOwnership:function(r){r.preventDefault();var a=this;if(this.formIsValid()){this.showLoading();var i={organization_id:e("#organization-id").val(),username:e("#username-ownership").val()};e.ajax({url:"/api/organizations/transfer-ownership/",type:"POST",data:i,success:function(r){if(a.hideLoading(),r.error){var i=s.template(e("#errors-template").html(),{Errors:[r.message]});e("#messages-container").html(i)}else window.location=r.redirect}})}},checkRequired:function(){var r=this,a=!0;return s.forEach(e("input,textarea,select").filter("[required]:visible"),function(s){var s=e(s);""===s.val()&&(a=!1,r.signalRequiredError(s))}),a},signalRequiredError:function(e){this.messages.push(e.siblings("label").text()+" This field is required.")},signalError:function(e){this.messages.push(e)},signalSuccess:function(){e("#messages-container").html(""),window.scroll(0,0)},showLoading:function(){var s='<div class="overlay"><img class="loading" src="/static/images/ajax-loader.gif"></div>';e(s).appendTo("body")},hideLoading:function(){e(".overlay").remove()},renderErrors:function(){var r=s.template(e("#errors-template").html(),{Errors:this.messages});e("#messages-container").html(r),this.messages=[],window.scroll(0,0)}});return a});