define(["jquery","underscore","backbone"],function(e,s,r){var t=r.View.extend({el:".member-list-container",messages:[],messagesSent:0,initialize:function(){console.log("RequestInfoFormView initialize")},events:{"click #send-info-request":"handleSendAsync"},formIsValid:function(){var s=!0;return 0===e("input[type=checkbox]:checked").length&&(this.signalError("Please check at least one Member."),s=!1),this.checkRequired()&&s?(this.signalSuccess(),!0):(this.renderErrors(),!1)},handleSendAsync:function(r){r.preventDefault(),this.messagesSent=0;var t=this;this.formIsValid()&&s.forEach(e("input[type=checkbox]:checked"),function(s){var r='<div id="loader"><img src="/static/images/ajax-loader.gif"></div>';e(r).appendTo(e(s).parent().parent()),t.sendRequestToMember(s)})},sendRequestToMember:function(r){var t=this,a={member_id:e(r).attr("data-member-id"),subject:e("#subject").val(),message:e("#message").val(),from:e("#from").val()};e.ajax({url:"/api/members/request-update/",type:"POST",data:a,success:function(a){if(a.error){e(r).parent().parent().find("#loader").remove();var n=s.template(e("#errors-template").html(),{Errors:[a.message]});e("#messages-container").html(n)}else{if(e(r).parent().parent().find("#loader").remove(),e(r).parent().parent().css("background-color","rgba(0,255,0,0.25)"),e(r).prop("checked",!1),t.messagesSent+=1,1===t.messagesSent)var i="1 request successfully sent.";else var i=t.messagesSent+" requests sent successfully.";var n=s.template(e("#messages-template").html(),{Messages:[i]});e("#messages-container").html(n)}}})},checkRequired:function(){var r=this,t=!0;return s.forEach(e("input,textarea,select").filter("[required]:visible"),function(s){var s=e(s);""===s.val()&&(t=!1,r.signalRequiredError(s))}),t},signalRequiredError:function(e){this.messages.push(e.siblings("label").text()+" This field is required.")},signalError:function(e){this.messages.push(e)},signalSuccess:function(){e("#messages-container").html(""),window.scroll(0,0)},renderErrors:function(){var r=s.template(e("#errors-template").html(),{Errors:this.messages});e("#messages-container").html(r),this.messages=[],window.scroll(0,0)}});return t});