{% extends "base.html" %}
{% load staticfiles %}

{% block require_js %}
<script>
  require([
    'src/views/organization-send-mail',
    'src/views/organization-filter',
  ], function(OrganizationSendMailView, OrganizationFilterView) {
    new OrganizationSendMailView();
    new OrganizationFilterView();
  });
</script>
{% endblock %}

{% block content %}

<div class="send-mail-container">

  <h2>Send email to members in <a href="{{ organization.get_absolute_url }}">{{ organization }}</a></h2>
  <br>

  <div class="left-align col-sm-3 filters">
    <h4>Filter members</h4>
    <br>

    <label>Gender :</label>
    <select id="gender-filter">
      <option value="">-----</option>
      <option value="Male">Male</option>
      <option value="Female">Female</option>
    </select>
    <br>

    <label>Graduating Class :</label>
    <select id="graduating-class-filter">
      <option value="">-----</option>
      <option value="1900">1900</option>
      <option value="1901">1901</option>
      <option value="1902">1901</option>
    </select>
    <br>
    <br>

    <button id="add-filter" class="btn btn-default">Filter</button>
  </div>
  
  <div class="centered col-sm-6">
    <form>
      <div id="organization-members">
        <table class="left-align table table-hover">
          <tr>
            <th>Include</th>
            <th>First Name</th>
            <th>Last Name</th>
            <th>Email</th>
          </tr>
          {% for member in members %}
          <tr href="{{ member.get_absolute_url }}">
            <td><input data-member-email="{{ member.email }}" type="checkbox" value="{{ member }}"></td>
            <td>{{ member.firstname }}</td>
            <td>{{ member.lastname }}</td>
            <td>{{ member.email }}</td>
          </tr>
          {% endfor %}
        </table>
      </div>
  
      <div class="centered col-md-8">
        <div class="form-group"> 
          <label>Subject:</label>
          <textarea id="subject" rows="1" class="form-control"></textarea>
          <br>
          <label>Message:</label>
          <textarea id="message" rows="8" class="form-control"></textarea>
          <br>
          <button id="send-mail" class="btn btn-success">Send</button>
        </div>
      </div>
    </form>
  </div>

  <input id="organization-id" type="hidden" value="{{ organization.pk }}"> 

  <script type="text/template" id="member-list-template">
    <table class="left-align table table-hover">
      <tr>
        <th>Include</th>
        <th>First Name</th>
        <th>Last Name</th>
        <th>Email</th>
      </tr>
      <% _.each(Members, function(member) { %>
      <tr href="/members/<%= member.get('pk') %>">
        <td><input data-member-email="<%= member.get('fields').email %>" type="checkbox" value="<%= member.get('fields').firstname + ' ' + member.get('fields').lastname %>"></td>
        <td><%= member.get('fields').firstname %></td>
        <td><%= member.get('fields').lastname %></td>
        <td><%= member.get('fields').email %></td>
      </tr>
      <% }); %>
    </table>
  </script>

</div>

{% endblock %}
